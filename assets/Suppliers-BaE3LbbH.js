import{e as v,r as o,u as k,j as e,D as C,f as O,P as D,B as N,a as w}from"./index-FFqeMi9I.js";import{S as l}from"./StatsCard-Dhy2wHwk.js";import{S as I}from"./SupplierSelect-DTx7JHT8.js";import{U as P,H as U,C as m}from"./users-round-B7agvDJm.js";function q(){const h=v(),[u,i]=o.useState(!1),[x,g]=o.useState(null),{data:s,isLoading:c,isError:p,error:r}=k({queryKey:["suppliers-table"],queryFn:w}),j=o.useMemo(()=>(s==null?void 0:s.filter(t=>t.balance>0).reduce((t,a)=>t+Number(a.balance),0))||0,[s]),n=s?Object.keys(s).length:0,d=s?Object.values(s).reduce((t,a)=>{var b;return t+(((b=a.purchases)==null?void 0:b.length)||0)},0):0,S=n>0?Math.round(d/n):0,y=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"name",label:"الاسم",sortable:!0},{key:"phone",label:"الهاتف",sortable:!0},{key:"balance",label:"الرصيد",sortable:!0},{key:"purchasesCount",label:"عدد عمليات الشراء",sortable:!0},{key:"lastUpdate",label:"اخر عملية",sortable:!0}],f=s?Object.values(s).map(t=>{var a;return{...t,purchasesCount:((a=t.purchases)==null?void 0:a.length)??0}}):[];return e.jsxs(C,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsx(l,{title:"إجمالي الموردين",value:n,icon:P}),e.jsx(l,{title:"ديون للموردين",value:j||0,icon:U}),e.jsx(l,{title:"إجمالي عمليات الشراء",value:d||0,icon:m}),e.jsx(l,{title:"متوسط عمليات الشراء",value:S,icon:m})]}),c&&e.jsx("p",{className:"text-center text-gray-500",children:"جاري التحميل..."}),p&&e.jsxs("p",{className:"text-center text-red-500",children:["حدث خطأ أثناء جلب البيانات:"," ",(r==null?void 0:r.message)||"Unknown error"]}),!c&&!p&&e.jsx(O,{title:"الموردين",titleButton:e.jsx(D,{isOpen:u,setIsOpen:i,title:"اضافة مورد",trigger:e.jsx(N,{className:"w-full",children:"اضافة مورد"}),children:e.jsx(I,{className:"mt-6",isOpen:u,setIsOpen:i,supplierId:x,setSupplierId:g,withDataTable:!0})}),columns:y,data:f,onRowClick:t=>{h("/SupplierDetails",{state:{id:t.id}})}})]})}export{q as default};
