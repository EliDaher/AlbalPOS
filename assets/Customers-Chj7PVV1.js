import{e as f,r as n,u as k,j as e,D as O,f as N,P as D,h as S,B as I,i as P}from"./index-FFqeMi9I.js";import{S as r}from"./StatsCard-Dhy2wHwk.js";import{U,H as w,C as p}from"./users-round-B7agvDJm.js";function R(){const h=f(),[u,c]=n.useState(!1),[x,g]=n.useState(null),{data:s,isLoading:i,isError:m,error:l}=k({queryKey:["customers-table"],queryFn:P}),j=n.useMemo(()=>-(s==null?void 0:s.filter(t=>t.balance<0).reduce((t,a)=>t+Number(a.balance),0))||0,[s]),o=s?Object.keys(s).length:0,d=s?Object.values(s).reduce((t,a)=>{var b;return t+(((b=a.purchases)==null?void 0:b.length)||0)},0):0,C=o>0?Math.round(d/o):0,y=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"name",label:"الاسم",sortable:!0},{key:"phone",label:"الهاتف",sortable:!0},{key:"balance",label:"الرصيد",sortable:!0},{key:"purchasesCount",label:"عدد عمليات الشراء",sortable:!0},{key:"lastUpdate",label:"اخر عملية",sortable:!0}],v=s?Object.values(s).map(t=>{var a;return{...t,purchasesCount:((a=t.purchases)==null?void 0:a.length)??0}}):[];return e.jsxs(O,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsx(r,{title:"إجمالي الزبائن",value:o,icon:U}),e.jsx(r,{title:"ديون على الزبائن",value:j||0,icon:w}),e.jsx(r,{title:"إجمالي عمليات الشراء",value:d||0,icon:p}),e.jsx(r,{title:"متوسط عمليات الشراء",value:C,icon:p})]}),i&&e.jsx("p",{className:"text-center text-gray-500",children:"جاري التحميل..."}),m&&e.jsxs("p",{className:"text-center text-red-500",children:["حدث خطأ أثناء جلب البيانات:"," ",(l==null?void 0:l.message)||"Unknown error"]}),!i&&!m&&e.jsx(N,{title:"الزبائن",titleButton:e.jsx(D,{isOpen:u,setIsOpen:c,title:"اضافة زبون",trigger:e.jsx(I,{className:"w-full",children:"اضافة زبون"}),children:e.jsx(S,{className:"mt-6",isOpen:u,setIsOpen:c,customerId:x,setCustomerId:g})}),columns:y,data:v,onRowClick:t=>{h("/CustomerDetails",{state:{id:t.id}})}})]})}export{R as default};
