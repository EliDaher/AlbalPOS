import{f as N,j as e,N as I,O as L,Q as O,U as q,V as E,W as Q,Y as z,r as i,m as K,u as U,a as Y,b as T,D as _,B as t,Z as B,P as $,F as b,_ as D,$ as G,a0 as R,a1 as V}from"./index-Cr_78kqx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=N("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=N("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=N("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function Z({chairsPerSide:l=2,state:u="available",tableNumber:g=1,tableName:y="",location:c=""}){const d=Array.from({length:l}),x=l*20+40,m=u==="available"?"bg-green-100 border-green-600":u==="occupied"?"bg-red-100 border-red-600":u==="reserved"?"bg-yellow-100 border-yellow-500":"bg-gray-200 border-gray-500",h=r=>{switch(r){case"available":return"متاحة";case"occupied":return"مشغولة";case"reserved":return"محجوزة";case"closed":return"مغلقة";default:return r}};return e.jsx(I,{children:e.jsxs(L,{children:[e.jsx(O,{asChild:!0,children:e.jsx("div",{className:"flex items-center justify-center cursor-pointer hover:scale-105 transition-transform duration-300",children:e.jsxs("div",{className:q("relative flex items-center justify-center rounded-xl shadow-md border-2",m),style:{width:"96px",height:`${x}px`},children:[e.jsx("span",{className:"absolute text-sm font-semibold text-gray-800",children:g}),d.map((r,n)=>{const p=100/(l+1);return e.jsx("div",{className:"absolute w-3 h-6 bg-gray-700 rounded-md",style:{left:"-12px",top:`${p*(n+1)}%`,transform:"translateY(-50%)"}},`left-${n}`)}),d.map((r,n)=>{const p=100/(l+1);return e.jsx("div",{className:"absolute w-3 h-6 bg-gray-700 rounded-md",style:{right:"-12px",top:`${p*(n+1)}%`,transform:"translateY(-50%)"}},`right-${n}`)})]})})}),e.jsx(E,{children:e.jsxs(Q,{className:"rounded-lg bg-gray-900 px-3 py-2 text-sm text-white shadow-lg space-y-1 text-right z-50",side:"top",sideOffset:5,children:[e.jsxs("div",{children:[e.jsx("strong",{children:"الطاولة:"})," ",y||`#${g}`]}),c&&e.jsxs("div",{children:[e.jsx("strong",{children:"الموقع:"})," ",c]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الحالة:"})," ",h(u)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"عدد المقاعد/جهة:"})," ",l]}),e.jsx(z,{className:"fill-gray-900"})]})})]})})}function ee(){const[l,u]=i.useState();i.useEffect(()=>{const a=JSON.parse(localStorage.getItem("InventoryUser")||"null");u(a)},[]);const[g,y]=i.useState(!1),[c,d]=i.useState(null),[x,m]=i.useState("available"),[h,r]=i.useState({name:"",location:"",capacity:1}),[n,p]=i.useState(""),[j,w]=i.useState("table"),C=K(),k=U(),{data:o,isLoading:S,isError:M}=Y({queryKey:["tables-table"],queryFn:V}),v=T({mutationFn:a=>G({table:a}),onSuccess:()=>{r({name:"",location:"",capacity:1}),alert("تمت العملية بنجاح"),y(!1),k.invalidateQueries({queryKey:["tables-table"]})},onError:()=>alert("حدث خطأ أثناء إضافة الطاولة")}),f=T({mutationFn:a=>R(a),onSuccess:()=>{alert("تم تعديل حالة الطاولة بنجاح"),d(null),k.invalidateQueries({queryKey:["tables-table"]})},onError:()=>alert("حدث خطأ أثناء تعديل حالة الطاولة")}),A=a=>{a.preventDefault();const{name:s,location:P,capacity:F}=h;if(!s.trim())return alert("يرجى إدخال اسم الطاولة");v.mutate({name:s,location:P,capacity:F,status:"available"})};return e.jsx(_,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"إدارة الطاولات"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(t,{variant:j==="table"?"default":"outline",onClick:()=>w("table"),className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"عرض كجدول"]}),e.jsxs(t,{variant:j==="grid"?"default":"outline",onClick:()=>w("grid"),className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"عرض كبطاقات"]}),e.jsx($,{title:"إضافة طاولة جديدة",isOpen:g,setIsOpen:y,trigger:e.jsxs(t,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"إضافة طاولة"]}),children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsx(b,{label:"اسم الطاولة",placeholder:"مثل: طاولة 1",value:h.name,onChange:a=>r(s=>({...s,name:a.target.value}))}),e.jsx(b,{label:"الموقع",placeholder:"الزاوية اليمنى - القسم الداخلي",value:h.location,onChange:a=>r(s=>({...s,location:a.target.value}))}),e.jsx(b,{label:"عدد المقاعد في كل جهة",type:"number",min:1,value:h.capacity,onChange:a=>r(s=>({...s,capacity:Number(a.target.value)}))}),e.jsx(t,{type:"submit",className:"w-full",disabled:v.isPending,children:v.isPending?e.jsx(D,{className:"w-4 h-4 animate-spin"}):"تأكيد الإضافة"})]})})]})]}),S&&e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(D,{className:"w-6 h-6 animate-spin text-gray-600"})}),M&&e.jsxs("div",{className:"flex justify-center items-center gap-2 py-10 text-red-500",children:[e.jsx(W,{className:"w-5 h-5"}),e.jsx("span",{children:"فشل في تحميل الطاولات"})]}),o&&j==="grid"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:o.map(a=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{onClick:()=>{d(a),m(a.status)},children:e.jsx(Z,{tableName:a.name,chairsPerSide:a.capacity,state:a.status,location:a.location})}),e.jsx(t,{variant:"outline",className:"mt-2",onClick:s=>{s.preventDefault(),C(`/tableDetails/${a.id}`,{state:a})},children:"تفاصيل"})]},a.id))}),o&&j==="table"&&e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-sm border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"الاسم"}),e.jsx("th",{className:"p-3",children:"الموقع"}),e.jsx("th",{className:"p-3",children:"السعة"}),e.jsx("th",{className:"p-3",children:"الحالة"}),e.jsx("th",{className:"p-3",children:"إجراءات"})]})}),e.jsx("tbody",{children:o.map(a=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 transition cursor-pointer",onClick:()=>d(a),children:[e.jsx("td",{className:"p-3",children:a.name}),e.jsx("td",{className:"p-3",children:a.location||"-"}),e.jsx("td",{className:"p-3 text-center",children:a.capacity*2}),e.jsx("td",{className:`p-3 font-medium ${a.status==="available"?"text-green-600":a.status==="occupied"?"text-red-600":a.status==="reserved"?"text-yellow-600":"text-gray-600"}`,children:a.status==="available"?"متاحة":a.status==="occupied"?"مشغولة":a.status==="reserved"?"محجوزة":"مغلقة"}),e.jsx("td",{className:"p-3",children:e.jsx(t,{size:"sm",variant:"outline",onClick:s=>{s.stopPropagation(),C(`/tableDetails/${a.id}`,{state:a})},children:"تفاصيل"})})]},a.id))})]})}),c&&e.jsx($,{title:`تعديل حالة ${c.name}`,isOpen:!!c,setIsOpen:()=>d(null),trigger:!0,children:e.jsxs("form",{onSubmit:a=>{a.preventDefault(),f.mutate({id:c.id,state:x,note:n,user:(l==null?void 0:l.username)||"غير معروف"})},children:[e.jsxs("div",{className:"flex gap-2 mb-4 justify-center items-center",children:[e.jsx(t,{type:"button",className:"w-full",variant:x==="available"?"accent":"outline",onClick:()=>m("available"),children:"متاحة"}),e.jsx(t,{type:"button",className:"w-full",variant:x==="reserved"?"accent":"outline",onClick:()=>m("reserved"),children:"محجوزة"}),e.jsx(t,{type:"button",className:"w-full",variant:x==="occupied"?"accent":"outline",onClick:()=>m("occupied"),children:"مشغولة"})]}),e.jsx(b,{label:"ملاحظات",value:n,onChange:a=>p(a.target.value)}),e.jsx(t,{type:"submit",className:"w-full mt-4",disabled:f.isPending,children:f.isPending?"جاري الحفظ ...":"حفظ"})]})}),!S&&(o==null?void 0:o.length)===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"لا توجد طاولات حالياً — قم بإضافة طاولة جديدة."})]})})}export{ee as default};
