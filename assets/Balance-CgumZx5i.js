import{l as f,a as y,r as n,j as t,D as v,ab as o,c as S,p as k}from"./index-DgmbDGaC.js";import{S as l}from"./StatsCard-BA7z7Bjq.js";import{R as C,O as D,K as N,X as w,Y as K,M,N as q,P as h}from"./BarChart-CjJ1OBQZ.js";async function A(){try{return(await f.get("/api/payments/")).data}catch(s){console.error("خطأ :",s)}}function Y(){const{data:s=[]}=y({queryKey:["payments-table"],queryFn:A}),{data:x=[]}=y({queryKey:["customers-table"],queryFn:k}),i=new Date().toISOString().split("T")[0],d=n.useMemo(()=>s.filter(e=>e.type==="sale").reduce((e,a)=>e+(a.amount||0),0),[s]),c=n.useMemo(()=>-s.filter(e=>e.type==="purchase").reduce((e,a)=>e+(a.amount||0),0),[s]),u=n.useMemo(()=>s.filter(e=>e.type==="sale"&&e.date.startsWith(i)).reduce((e,a)=>e+(a.amount||0),0),[s]),m=n.useMemo(()=>s.filter(e=>e.type==="purchase"&&e.date.startsWith(i)).reduce((e,a)=>e+(a.amount||0),0),[s]),p=s.reduce((e,a)=>{const r=new Date(a.date).toLocaleString("ar-SY",{month:"short",year:"2-digit"});return e[r]||(e[r]={month:r,sales:0,purchases:0}),a.type==="sale"?e[r].sales+=a.amount:e[r].purchases+=a.amount,e},{})??{},j=Object.values(p),b=s.map(e=>{var a;return{...e,customerName:((a=x.find(r=>r.id===e.relatedId))==null?void 0:a.name)||"غير معروف"}}),g=[{key:"id",label:"الرمز",sortable:!0,hidden:!0},{key:"amount",label:"المبلغ",sortable:!0},{key:"note",label:"الملاحظة",sortable:!0},{key:"method",label:"طريقة الدفع",sortable:!0},{key:"type",label:"النوع",sortable:!0},{key:"customerName",label:"العميل / المورد",sortable:!0},{key:"date",label:"التاريخ",sortable:!0,render:e=>new Date(e.date).toLocaleString("ar-SY",{dateStyle:"short",timeStyle:"short"})}];return t.jsx(v,{children:t.jsxs("div",{className:"p-4 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(l,{title:"إجمالي المبيعات",icon:o,value:d}),t.jsx(l,{title:"إجمالي المشتريات",icon:o,value:c}),t.jsx(l,{title:"الرصيد الصافي",icon:o,value:d-c})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(l,{title:"مقبوضات اليوم",icon:o,value:u}),t.jsx(l,{title:"مدفوعات اليوم",icon:o,value:m}),t.jsx(l,{title:"صندوق اليوم",icon:o,value:u-m})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow p-4",children:[t.jsx("h2",{className:"text-xl font-bold mb-2",children:"توزيع الدفعات الشهرية"}),t.jsx(C,{width:"100%",height:300,children:t.jsxs(D,{data:j,children:[t.jsx(N,{strokeDasharray:"3 3"}),t.jsx(w,{dataKey:"month"}),t.jsx(K,{}),t.jsx(M,{}),t.jsx(q,{}),t.jsx(h,{dataKey:"sales",name:"المبيعات",fill:"hsl(var(--secondary))"}),t.jsx(h,{dataKey:"purchases",name:"المشتريات",fill:"hsl(var(--accent))"})]})})]}),t.jsx(S,{data:b,title:"سجل الدفعات",columns:g})]})})}export{Y as default};
