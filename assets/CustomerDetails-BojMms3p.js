import{m as L,E as R,u as U,r as a,a as k,b as g,j as e,D as B,B as i,A as Q,C as f,s as K,t as M,S as N,P as T,F as v,c as S,M as V,n as r,N as H}from"./index-DgmbDGaC.js";function te(){var y,b;const C=L(),n=R().state,u=U(),[D,l]=a.useState(!1),[z,I]=a.useState(!1),[d,m]=a.useState(""),[p,x]=a.useState(""),[w,G]=a.useState(""),[W,O]=a.useState(0),[X,Y]=a.useState("cash"),[Z,_]=a.useState(0),[$,ee]=a.useState(""),[A,E]=a.useState();a.useEffect(()=>{const s=JSON.parse(localStorage.getItem("InventoryUser")||"null");E(s)},[]);const{data:t,isLoading:h,isError:P,error:o}=k({queryKey:["customer-details",n],queryFn:()=>H(n),enabled:!!n}),c=g({mutationFn:s=>V(s),onSuccess:()=>{r.success("تمت إضافة الدفعة بنجاح!"),m(""),x(""),l(!1),u.invalidateQueries({queryKey:["customer-details",n]})},onError:s=>{console.error(s),r.error("حدث خطأ أثناء الدفع")}});g({mutationFn:s=>s,onSuccess:()=>{r.success("تم الإرجاع بنجاح!"),O(0),I(!1),u.invalidateQueries({queryKey:["customer-details",n]})},onError:s=>{console.error(s),r.error("حدث خطأ أثناء الإرجاع")}});const F=[{label:"المعرف",key:"id",hidden:!0},{label:"المبلغ",key:"total",sortable:!0},{label:"الوصف",key:"note"},{label:"التاريخ",key:"date",sortable:!0}],q=[{label:"المعرف",key:"id",hidden:!0},{label:"اسم المادة",key:"item"},{label:"الكمية",key:"itemAmount"},{label:"السعر",key:"total",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}];return e.jsx(B,{children:e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"بيانات المورد"}),e.jsxs(i,{onClick:()=>C("/customers"),variant:"outline",children:[e.jsx(Q,{className:"ml-2 w-4 h-4"})," رجوع"]})]}),e.jsxs(f,{children:[e.jsx(K,{children:e.jsx(M,{children:"المعلومات الأساسية"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4",children:h?e.jsx(N,{className:"h-6 w-full"}):P?e.jsx("p",{className:"text-red-500",children:(o==null?void 0:o.message)||"حدث خطأ"}):Object.entries(t).filter(([s])=>!["payments","purchases","id"].includes(s)).map(([s,j])=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("label",{className:"font-bold w-36",children:[s=="balance"?"الرصيد":s=="createdAt"?"تاريخ التسجيل":s=="lastUpdate"?"اخر تعديل":s=="name"?"الاسم":s=="notes"?"ملاحظات":s=="phone"?"الرقم":s,":"]}),e.jsx("span",{children:s.includes("date")?new Date(j).toLocaleString():j})]},s))}),e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:e.jsx(T,{title:"دفعة من الزبون",trigger:e.jsx(i,{variant:"accent",onClick:()=>l(!0),children:"دفعة من الزبون"}),isOpen:D,setIsOpen:l,children:e.jsxs("form",{className:"space-y-4",onSubmit:s=>{s.preventDefault(),c.mutate({customerId:n.id,paymentData:{type:"purchase",relatedId:n.id,amount:Number(d),method:"cash",note:p,date:w,createdBy:A.username||"user"},type:"in"})},children:[e.jsx(v,{label:"قيمة الدفعة",id:"payment-amount",type:"text",value:d,onChange:s=>m(s.target.value)}),e.jsx(v,{label:"ملاحظات",id:"note",type:"text",value:p,onChange:s=>x(s.target.value)}),e.jsx(i,{type:"submit",className:"w-full",disabled:c.isPending,children:c.isPending?"جاري الدفع...":"دفعة من الزبون"})]})})})]}),e.jsx(f,{className:"overflow-x-auto",children:h?e.jsx(N,{className:"h-48 w-full"}):((y=t==null?void 0:t.payments)==null?void 0:y.length)===0&&((b=t==null?void 0:t.purchases)==null?void 0:b.length)===0?e.jsx("p",{className:"text-center text-gray-500",children:"لا توجد معاملات حالياً"}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 p-4",children:[e.jsx(S,{title:"الدفعات",columns:F,data:(t==null?void 0:t.payments)||[]}),e.jsx(S,{title:"عمليات الشراء",columns:q,data:(t==null?void 0:t.purchases)||[]})]})})]})})}export{te as default};
