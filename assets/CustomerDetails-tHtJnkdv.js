import{m as F,p as L,u as R,r as a,a as U,b as j,j as e,D as k,B as c,A as B,C as g,q as Q,s as K,S as f,P as M,F as v,c as N,t as T,v as V}from"./index-Cr_78kqx.js";function se(){var h,y;const S=F(),n=L().state,i=R(),[C,l]=a.useState(!1),[J,D]=a.useState(!1),[u,d]=a.useState(""),[m,p]=a.useState(""),[I,z]=a.useState(""),[G,w]=a.useState(0),[W,X]=a.useState("cash"),[Y,Z]=a.useState(0),[_,$]=a.useState(""),[O,A]=a.useState();a.useEffect(()=>{const s=JSON.parse(localStorage.getItem("InventoryUser")||"null");A(s)},[]);const{data:t,isLoading:x,isError:P,error:r}=U({queryKey:["customer-details",n],queryFn:()=>V(n),enabled:!!n}),o=j({mutationFn:s=>T(s),onSuccess:()=>{alert("تمت إضافة الدفعة بنجاح!"),d(""),p(""),l(!1),i.invalidateQueries({queryKey:["customer-details",n]})},onError:s=>{console.error(s),alert("حدث خطأ أثناء الدفع")}});j({mutationFn:s=>s,onSuccess:()=>{alert("تم الإرجاع بنجاح!"),w(0),D(!1),i.invalidateQueries({queryKey:["customer-details",n]})},onError:s=>{console.error(s),alert("حدث خطأ أثناء الإرجاع")}});const q=[{label:"المعرف",key:"id",hidden:!0},{label:"المبلغ",key:"total",sortable:!0},{label:"الوصف",key:"note"},{label:"التاريخ",key:"date",sortable:!0}],E=[{label:"المعرف",key:"id",hidden:!0},{label:"اسم المادة",key:"item"},{label:"الكمية",key:"itemAmount"},{label:"السعر",key:"total",sortable:!0},{label:"التاريخ",key:"date",sortable:!0}];return e.jsx(k,{children:e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"بيانات المورد"}),e.jsxs(c,{onClick:()=>S("/customers"),variant:"outline",children:[e.jsx(B,{className:"ml-2 w-4 h-4"})," رجوع"]})]}),e.jsxs(g,{children:[e.jsx(Q,{children:e.jsx(K,{children:"المعلومات الأساسية"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4",children:x?e.jsx(f,{className:"h-6 w-full"}):P?e.jsx("p",{className:"text-red-500",children:(r==null?void 0:r.message)||"حدث خطأ"}):Object.entries(t).filter(([s])=>!["payments","purchases","id"].includes(s)).map(([s,b])=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("label",{className:"font-bold w-36",children:[s=="balance"?"الرصيد":s=="createdAt"?"تاريخ التسجيل":s=="lastUpdate"?"اخر تعديل":s=="name"?"الاسم":s=="notes"?"ملاحظات":s=="phone"?"الرقم":s,":"]}),e.jsx("span",{children:s.includes("date")?new Date(b).toLocaleString():b})]},s))}),e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:e.jsx(M,{title:"دفعة من الزبون",trigger:e.jsx(c,{variant:"accent",onClick:()=>l(!0),children:"دفعة من الزبون"}),isOpen:C,setIsOpen:l,children:e.jsxs("form",{className:"space-y-4",onSubmit:s=>{s.preventDefault(),o.mutate({customerId:n.id,paymentData:{type:"purchase",relatedId:n.id,amount:Number(u),method:"cash",note:m,date:I,createdBy:O.username||"user"},type:"in"})},children:[e.jsx(v,{label:"قيمة الدفعة",id:"payment-amount",type:"text",value:u,onChange:s=>d(s.target.value)}),e.jsx(v,{label:"ملاحظات",id:"note",type:"text",value:m,onChange:s=>p(s.target.value)}),e.jsx(c,{type:"submit",className:"w-full",disabled:o.isPending,children:o.isPending?"جاري الدفع...":"دفعة من الزبون"})]})})})]}),e.jsx(g,{className:"overflow-x-auto",children:x?e.jsx(f,{className:"h-48 w-full"}):((h=t==null?void 0:t.payments)==null?void 0:h.length)===0&&((y=t==null?void 0:t.purchases)==null?void 0:y.length)===0?e.jsx("p",{className:"text-center text-gray-500",children:"لا توجد معاملات حالياً"}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 p-4",children:[e.jsx(N,{title:"الدفعات",columns:q,data:(t==null?void 0:t.payments)||[]}),e.jsx(N,{title:"عمليات الشراء",columns:E,data:(t==null?void 0:t.purchases)||[]})]})})]})})}export{se as default};
