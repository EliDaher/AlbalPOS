import{f as C,j as e,O as L,Q as O,U as q,V as E,W as Q,Y as z,Z as K,r as i,m as U,u as Y,a as _,b as $,D as B,P as D,F as f,B as t,_ as P,$ as G,n as y,a0 as R,a1 as V,a2 as H}from"./index-DzO30t4C.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=C("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=C("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=C("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function X({chairsPerSide:l=2,state:d="available",tableNumber:j=1,tableName:h="",location:c=""}){const m=Array.from({length:l}),u=l*20+40,p=d==="available"?"bg-green-100 border-green-600":d==="occupied"?"bg-red-100 border-red-600":d==="reserved"?"bg-yellow-100 border-yellow-500":"bg-gray-200 border-gray-500",x=r=>{switch(r){case"available":return"متاحة";case"occupied":return"مشغولة";case"reserved":return"محجوزة";case"closed":return"مغلقة";default:return r}};return e.jsx(L,{children:e.jsxs(O,{children:[e.jsx(q,{asChild:!0,children:e.jsx("div",{className:"flex items-center justify-center cursor-pointer hover:scale-105 transition-transform duration-300",children:e.jsxs("div",{className:E("relative flex items-center justify-center rounded-xl shadow-md border-2",p),style:{width:"96px",height:`${u}px`},children:[e.jsx("span",{className:"absolute text-2xl font-bold text-gray-800",children:h||`#${j}`}),m.map((r,n)=>{const g=100/(l+1);return e.jsx("div",{className:"absolute w-3 h-6 bg-gray-700 rounded-md",style:{left:"-12px",top:`${g*(n+1)}%`,transform:"translateY(-50%)"}},`left-${n}`)}),m.map((r,n)=>{const g=100/(l+1);return e.jsx("div",{className:"absolute w-3 h-6 bg-gray-700 rounded-md",style:{right:"-12px",top:`${g*(n+1)}%`,transform:"translateY(-50%)"}},`right-${n}`)})]})})}),e.jsx(Q,{children:e.jsxs(z,{className:"rounded-lg bg-gray-900 px-3 py-2 text-sm text-white shadow-lg space-y-1 text-right z-50",side:"top",sideOffset:5,children:[e.jsxs("div",{children:[e.jsx("strong",{children:"الطاولة:"})," ",h||`#${j}`]}),c&&e.jsxs("div",{children:[e.jsx("strong",{children:"الموقع:"})," ",c]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الحالة:"})," ",x(d)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"عدد المقاعد/جهة:"})," ",l]}),e.jsx(K,{className:"fill-gray-900"})]})})]})})}function ae(){const[l,d]=i.useState();i.useEffect(()=>{const a=JSON.parse(localStorage.getItem("InventoryUser")||"null");d(a)},[]);const[j,h]=i.useState(!1),[c,m]=i.useState(null),[u,p]=i.useState("available"),[x,r]=i.useState({name:"",location:"",capacity:1}),[n,g]=i.useState(""),[b,k]=i.useState("grid"),v=U(),S=Y(),{data:o,isLoading:T,isError:M}=_({queryKey:["tables-table"],queryFn:H}),N=$({mutationFn:a=>R({table:a}),onSuccess:()=>{r({name:"",location:"",capacity:1}),y.success("تمت العملية بنجاح"),h(!1),S.invalidateQueries({queryKey:["tables-table"]})},onError:()=>y.error("حدث خطأ أثناء إضافة الطاولة")}),w=$({mutationFn:a=>V(a),onSuccess:()=>{y.success("تم تعديل حالة الطاولة بنجاح"),m(null),S.invalidateQueries({queryKey:["tables-table"]})},onError:()=>y.error("حدث خطأ أثناء تعديل حالة الطاولة")}),A=a=>{a.preventDefault();const{name:s,location:F,capacity:I}=x;if(!s.trim())return y.error("يرجى إدخال اسم الطاولة");N.mutate({name:s,location:F,capacity:I,status:"available"})};return e.jsx(B,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"إدارة الطاولات"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(D,{title:"إضافة طاولة جديدة",isOpen:j,setIsOpen:h,trigger:e.jsxs(t,{variant:"accent",className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"إضافة طاولة"]}),children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsx(f,{label:"اسم الطاولة",placeholder:"مثل: طاولة 1",value:x.name,onChange:a=>r(s=>({...s,name:a.target.value}))}),e.jsx(f,{label:"الموقع",placeholder:"الزاوية اليمنى - القسم الداخلي",value:x.location,onChange:a=>r(s=>({...s,location:a.target.value}))}),e.jsx(f,{label:"عدد المقاعد في كل جهة",type:"number",min:1,value:x.capacity,onChange:a=>r(s=>({...s,capacity:Number(a.target.value)}))}),e.jsx(t,{type:"submit",className:"w-full",disabled:N.isPending,children:N.isPending?e.jsx(P,{className:"w-4 h-4 animate-spin"}):"تأكيد الإضافة"})]})}),e.jsxs(t,{variant:b==="grid"?"default":"outline",onClick:()=>k("grid"),className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"عرض كبطاقات"]}),e.jsxs(t,{variant:b==="table"?"default":"outline",onClick:()=>k("table"),className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"عرض كجدول"]})]})]}),T&&e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(P,{className:"w-6 h-6 animate-spin text-gray-600"})}),M&&e.jsxs("div",{className:"flex justify-center items-center gap-2 py-10 text-red-500",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{children:"فشل في تحميل الطاولات"})]}),o&&b==="grid"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:o.map(a=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{onClick:s=>{s.stopPropagation(),v(`/tableDetails/${a.id}`,{state:a})},children:e.jsx(X,{tableName:a.name,chairsPerSide:a.capacity,state:a.status,location:a.location})}),e.jsx(t,{variant:"outline",className:"mt-2",onClick:s=>{s.preventDefault(),v(`/tableDetails/${a.id}`,{state:a})},children:"تفاصيل"})]},a.id))}),o&&b==="table"&&e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-sm border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"الاسم"}),e.jsx("th",{className:"p-3",children:"الموقع"}),e.jsx("th",{className:"p-3",children:"السعة"}),e.jsx("th",{className:"p-3",children:"الحالة"}),e.jsx("th",{className:"p-3",children:"إجراءات"})]})}),e.jsx("tbody",{children:o.map(a=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 transition cursor-pointer",onClick:s=>{s.stopPropagation(),v(`/tableDetails/${a.id}`,{state:a})},children:[e.jsx("td",{className:"p-3",children:a.name}),e.jsx("td",{className:"p-3",children:a.location||"-"}),e.jsx("td",{className:"p-3 text-center",children:a.capacity*2}),e.jsx("td",{className:`p-3 font-medium ${a.status==="available"?"text-green-600":a.status==="occupied"?"text-red-600":a.status==="reserved"?"text-yellow-600":"text-gray-600"}`,children:a.status==="available"?"متاحة":a.status==="occupied"?"مشغولة":a.status==="reserved"?"محجوزة":"مغلقة"}),e.jsx("td",{className:"p-3",children:e.jsx(t,{size:"sm",variant:"outline",onClick:s=>{s.stopPropagation(),v(`/tableDetails/${a.id}`,{state:a})},children:"تفاصيل"})})]},a.id))})]})}),c&&e.jsx(D,{title:`تعديل حالة ${c.name}`,isOpen:!!c,setIsOpen:()=>m(null),trigger:!0,children:e.jsxs("form",{onSubmit:a=>{a.preventDefault(),w.mutate({id:c.id,state:u,note:n,user:(l==null?void 0:l.username)||"غير معروف"})},children:[e.jsxs("div",{className:"flex gap-2 mb-4 justify-center items-center",children:[e.jsx(t,{type:"button",className:"w-full",variant:u==="available"?"accent":"outline",onClick:()=>p("available"),children:"متاحة"}),e.jsx(t,{type:"button",className:"w-full",variant:u==="reserved"?"accent":"outline",onClick:()=>p("reserved"),children:"محجوزة"}),e.jsx(t,{type:"button",className:"w-full",variant:u==="occupied"?"accent":"outline",onClick:()=>p("occupied"),children:"مشغولة"})]}),e.jsx(f,{label:"ملاحظات",value:n,onChange:a=>g(a.target.value)}),e.jsx(t,{type:"submit",className:"w-full mt-4",disabled:w.isPending,children:w.isPending?"جاري الحفظ ...":"حفظ"})]})}),!T&&(o==null?void 0:o.length)===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"لا توجد طاولات حالياً — قم بإضافة طاولة جديدة."})]})})}export{ae as default};
